import{r as b,W as p,j as k,B as S,an as _}from"./index-C_g83nc7.js";import{B as P}from"./BaseFileInput-c8nMlesD.js";var B=Object.defineProperty,O=(d,t,e)=>t in d?B(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e,u=(d,t,e)=>O(d,typeof t!="symbol"?t+"":t,e);const I={x:0,y:0,width:0,height:0,unit:"px"},R=(d,t,e)=>Math.min(Math.max(d,t),e),N=(...d)=>d.filter(t=>t&&typeof t=="string").join(" "),$=(d,t)=>d===t||d.width===t.width&&d.height===t.height&&d.x===t.x&&d.y===t.y&&d.unit===t.unit;function M(d,t,e){return d.unit==="%"?{...I,...d,unit:"%"}:{unit:"%",x:d.x?d.x/t*100:0,y:d.y?d.y/e*100:0,width:d.width?d.width/t*100:0,height:d.height?d.height/e*100:0}}function D(d,t,e){return d.unit?d.unit==="px"?{...I,...d,unit:"px"}:{unit:"px",x:d.x?d.x*t/100:0,y:d.y?d.y*e/100:0,width:d.width?d.width*t/100:0,height:d.height?d.height*e/100:0}:{...I,...d,unit:"px"}}function K(d,t,e,o,i,n=0,a=0,c=o,h=i){const r={...d};let l=Math.min(n,o),g=Math.min(a,i),w=Math.min(c,o),s=Math.min(h,i);t&&(t>1?(l=a?a*t:l,g=l/t,w=c*t):(g=n?n/t:g,l=g*t,s=h/t)),r.y<0&&(r.height=Math.max(r.height+r.y,g),r.y=0),r.x<0&&(r.width=Math.max(r.width+r.x,l),r.x=0);const x=o-(r.x+r.width);x<0&&(r.x=Math.min(r.x,o-l),r.width+=x);const y=i-(r.y+r.height);if(y<0&&(r.y=Math.min(r.y,i-g),r.height+=y),r.width<l&&((e==="sw"||e=="nw")&&(r.x-=l-r.width),r.width=l),r.height<g&&((e==="nw"||e=="ne")&&(r.y-=g-r.height),r.height=g),r.width>w&&((e==="sw"||e=="nw")&&(r.x-=w-r.width),r.width=w),r.height>s&&((e==="nw"||e=="ne")&&(r.y-=s-r.height),r.height=s),t){const f=r.width/r.height;if(f<t){const m=Math.max(r.width/t,g);(e==="nw"||e=="ne")&&(r.y-=m-r.height),r.height=m}else if(f>t){const m=Math.max(r.height*t,l);(e==="sw"||e=="nw")&&(r.x-=m-r.width),r.width=m}}return r}function A(d,t,e,o){const i={...d};return t==="ArrowLeft"?o==="nw"?(i.x-=e,i.y-=e,i.width+=e,i.height+=e):o==="w"?(i.x-=e,i.width+=e):o==="sw"?(i.x-=e,i.width+=e,i.height+=e):o==="ne"?(i.y+=e,i.width-=e,i.height-=e):o==="e"?i.width-=e:o==="se"&&(i.width-=e,i.height-=e):t==="ArrowRight"&&(o==="nw"?(i.x+=e,i.y+=e,i.width-=e,i.height-=e):o==="w"?(i.x+=e,i.width-=e):o==="sw"?(i.x+=e,i.width-=e,i.height-=e):o==="ne"?(i.y-=e,i.width+=e,i.height+=e):o==="e"?i.width+=e:o==="se"&&(i.width+=e,i.height+=e)),t==="ArrowUp"?o==="nw"?(i.x-=e,i.y-=e,i.width+=e,i.height+=e):o==="n"?(i.y-=e,i.height+=e):o==="ne"?(i.y-=e,i.width+=e,i.height+=e):o==="sw"?(i.x+=e,i.width-=e,i.height-=e):o==="s"?i.height-=e:o==="se"&&(i.width-=e,i.height-=e):t==="ArrowDown"&&(o==="nw"?(i.x+=e,i.y+=e,i.width-=e,i.height-=e):o==="n"?(i.y+=e,i.height-=e):o==="ne"?(i.y+=e,i.width-=e,i.height-=e):o==="sw"?(i.x-=e,i.width+=e,i.height+=e):o==="s"?i.height+=e:o==="se"&&(i.width+=e,i.height+=e)),i}const E={capture:!0,passive:!1};let L=0;const v=class C extends b.PureComponent{constructor(){super(...arguments),u(this,"docMoveBound",!1),u(this,"mouseDownOnCrop",!1),u(this,"dragStarted",!1),u(this,"evData",{startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0}),u(this,"componentRef",b.createRef()),u(this,"mediaRef",b.createRef()),u(this,"resizeObserver"),u(this,"initChangeCalled",!1),u(this,"instanceId",`rc-${L++}`),u(this,"state",{cropIsActive:!1,newCropIsBeingDrawn:!1}),u(this,"onCropPointerDown",t=>{const{crop:e,disabled:o}=this.props,i=this.getBox();if(!e)return;const n=D(e,i.width,i.height);if(o)return;t.cancelable&&t.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const a=t.target.dataset.ord,c=!!a;let h=t.clientX,r=t.clientY,l=n.x,g=n.y;if(a){const w=t.clientX-i.x,s=t.clientY-i.y;let x=0,y=0;a==="ne"||a=="e"?(x=w-(n.x+n.width),y=s-n.y,l=n.x,g=n.y+n.height):a==="se"||a==="s"?(x=w-(n.x+n.width),y=s-(n.y+n.height),l=n.x,g=n.y):a==="sw"||a=="w"?(x=w-n.x,y=s-(n.y+n.height),l=n.x+n.width,g=n.y):(a==="nw"||a=="n")&&(x=w-n.x,y=s-n.y,l=n.x+n.width,g=n.y+n.height),h=l+i.x+x,r=g+i.y+y}this.evData={startClientX:h,startClientY:r,startCropX:l,startCropY:g,clientX:t.clientX,clientY:t.clientY,isResize:c,ord:a},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})}),u(this,"onComponentPointerDown",t=>{const{crop:e,disabled:o,locked:i,keepSelection:n,onChange:a}=this.props,c=this.getBox();if(o||i||n&&e)return;t.cancelable&&t.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const h=t.clientX-c.x,r=t.clientY-c.y,l={unit:"px",x:h,y:r,width:0,height:0};this.evData={startClientX:t.clientX,startClientY:t.clientY,startCropX:h,startCropY:r,clientX:t.clientX,clientY:t.clientY,isResize:!0},this.mouseDownOnCrop=!0,a(D(l,c.width,c.height),M(l,c.width,c.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})}),u(this,"onDocPointerMove",t=>{const{crop:e,disabled:o,onChange:i,onDragStart:n}=this.props,a=this.getBox();if(o||!e||!this.mouseDownOnCrop)return;t.cancelable&&t.preventDefault(),this.dragStarted||(this.dragStarted=!0,n&&n(t));const{evData:c}=this;c.clientX=t.clientX,c.clientY=t.clientY;let h;c.isResize?h=this.resizeCrop():h=this.dragCrop(),$(e,h)||i(D(h,a.width,a.height),M(h,a.width,a.height))}),u(this,"onComponentKeyDown",t=>{const{crop:e,disabled:o,onChange:i,onComplete:n}=this.props;if(o)return;const a=t.key;let c=!1;if(!e)return;const h=this.getBox(),r=this.makePixelCrop(h),l=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?C.nudgeStepLarge:t.shiftKey?C.nudgeStepMedium:C.nudgeStep;if(a==="ArrowLeft"?(r.x-=l,c=!0):a==="ArrowRight"?(r.x+=l,c=!0):a==="ArrowUp"?(r.y-=l,c=!0):a==="ArrowDown"&&(r.y+=l,c=!0),c){t.cancelable&&t.preventDefault(),r.x=R(r.x,0,h.width-r.width),r.y=R(r.y,0,h.height-r.height);const g=D(r,h.width,h.height),w=M(r,h.width,h.height);i(g,w),n&&n(g,w)}}),u(this,"onHandlerKeyDown",(t,e)=>{const{aspect:o=0,crop:i,disabled:n,minWidth:a=0,minHeight:c=0,maxWidth:h,maxHeight:r,onChange:l,onComplete:g}=this.props,w=this.getBox();if(n||!i)return;if(t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="ArrowLeft"||t.key==="ArrowRight")t.stopPropagation(),t.preventDefault();else return;const s=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?C.nudgeStepLarge:t.shiftKey?C.nudgeStepMedium:C.nudgeStep,x=D(i,w.width,w.height),y=A(x,t.key,s,e),f=K(y,o,e,w.width,w.height,a,c,h,r);if(!$(i,f)){const m=M(f,w.width,w.height);l(f,m),g&&g(f,m)}}),u(this,"onDocPointerDone",t=>{const{crop:e,disabled:o,onComplete:i,onDragEnd:n}=this.props,a=this.getBox();this.unbindDocMove(),!(o||!e)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,n&&n(t),i&&i(D(e,a.width,a.height),M(e,a.width,a.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))}),u(this,"onDragFocus",()=>{var t;(t=this.componentRef.current)==null||t.scrollTo(0,0)})}get document(){return document}getBox(){const t=this.mediaRef.current;if(!t)return{x:0,y:0,width:0,height:0};const{x:e,y:o,width:i,height:n}=t.getBoundingClientRect();return{x:e,y:o,width:i,height:n}}componentDidUpdate(t){const{crop:e,onComplete:o}=this.props;if(o&&!t.crop&&e){const{width:i,height:n}=this.getBox();i&&n&&o(D(e,i,n),M(e,i,n))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,E),this.document.addEventListener("pointerup",this.onDocPointerDone,E),this.document.addEventListener("pointercancel",this.onDocPointerDone,E),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,E),this.document.removeEventListener("pointerup",this.onDocPointerDone,E),this.document.removeEventListener("pointercancel",this.onDocPointerDone,E),this.docMoveBound=!1)}getCropStyle(){const{crop:t}=this.props;if(t)return{top:`${t.y}${t.unit}`,left:`${t.x}${t.unit}`,width:`${t.width}${t.unit}`,height:`${t.height}${t.unit}`}}dragCrop(){const{evData:t}=this,e=this.getBox(),o=this.makePixelCrop(e),i=t.clientX-t.startClientX,n=t.clientY-t.startClientY;return o.x=R(t.startCropX+i,0,e.width-o.width),o.y=R(t.startCropY+n,0,e.height-o.height),o}getPointRegion(t,e,o,i){const{evData:n}=this,a=n.clientX-t.x,c=n.clientY-t.y;let h;i&&e?h=e==="nw"||e==="n"||e==="ne":h=c<n.startCropY;let r;return o&&e?r=e==="nw"||e==="w"||e==="sw":r=a<n.startCropX,r?h?"nw":"sw":h?"ne":"se"}resolveMinDimensions(t,e,o=0,i=0){const n=Math.min(o,t.width),a=Math.min(i,t.height);return!e||!n&&!a?[n,a]:e>1?n?[n,n/e]:[a*e,a]:a?[a*e,a]:[n,n/e]}resizeCrop(){const{evData:t}=this,{aspect:e=0,maxWidth:o,maxHeight:i}=this.props,n=this.getBox(),[a,c]=this.resolveMinDimensions(n,e,this.props.minWidth,this.props.minHeight);let h=this.makePixelCrop(n);const r=this.getPointRegion(n,t.ord,a,c),l=t.ord||r;let g=t.clientX-t.startClientX,w=t.clientY-t.startClientY;(a&&l==="nw"||l==="w"||l==="sw")&&(g=Math.min(g,-a)),(c&&l==="nw"||l==="n"||l==="ne")&&(w=Math.min(w,-c));const s={unit:"px",x:0,y:0,width:0,height:0};r==="ne"?(s.x=t.startCropX,s.width=g,e?(s.height=s.width/e,s.y=t.startCropY-s.height):(s.height=Math.abs(w),s.y=t.startCropY-s.height)):r==="se"?(s.x=t.startCropX,s.y=t.startCropY,s.width=g,e?s.height=s.width/e:s.height=w):r==="sw"?(s.x=t.startCropX+g,s.y=t.startCropY,s.width=Math.abs(g),e?s.height=s.width/e:s.height=w):r==="nw"&&(s.x=t.startCropX+g,s.width=Math.abs(g),e?(s.height=s.width/e,s.y=t.startCropY-s.height):(s.height=Math.abs(w),s.y=t.startCropY+w));const x=K(s,e,r,n.width,n.height,a,c,o,i);return e||C.xyOrds.indexOf(l)>-1?h=x:C.xOrds.indexOf(l)>-1?(h.x=x.x,h.width=x.width):C.yOrds.indexOf(l)>-1&&(h.y=x.y,h.height=x.height),h.x=R(h.x,0,n.width-h.width),h.y=R(h.y,0,n.height-h.height),h}renderCropSelection(){const{ariaLabels:t=C.defaultProps.ariaLabels,disabled:e,locked:o,renderSelectionAddon:i,ruleOfThirds:n,crop:a}=this.props,c=this.getCropStyle();if(a)return p.createElement("div",{style:c,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":t.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!e&&!o&&p.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},p.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),p.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),p.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),p.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":t.nwDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"nw"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":t.nDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"n"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":t.neDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"ne"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":t.eDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"e"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":t.seDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"se"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":t.sDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"s"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":t.swDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"sw"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":t.wDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"w"),role:"button"})),i&&p.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:h=>h.stopPropagation()},i(this.state)),n&&p.createElement(p.Fragment,null,p.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),p.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(t){const e={...I,...this.props.crop||{}};return D(e,t.width,t.height)}render(){const{aspect:t,children:e,circularCrop:o,className:i,crop:n,disabled:a,locked:c,style:h,ruleOfThirds:r}=this.props,{cropIsActive:l,newCropIsBeingDrawn:g}=this.state,w=n?this.renderCropSelection():null,s=N("ReactCrop",i,l&&"ReactCrop--active",a&&"ReactCrop--disabled",c&&"ReactCrop--locked",g&&"ReactCrop--new-crop",n&&t&&"ReactCrop--fixed-aspect",n&&o&&"ReactCrop--circular-crop",n&&r&&"ReactCrop--rule-of-thirds",!this.dragStarted&&n&&!n.width&&!n.height&&"ReactCrop--invisible-crop",o&&"ReactCrop--no-animate");return p.createElement("div",{ref:this.componentRef,className:s,style:h},p.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},e),n?p.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},p.createElement("defs",null,p.createElement("mask",{id:`hole-${this.instanceId}`},p.createElement("rect",{width:"100%",height:"100%",fill:"white"}),o?p.createElement("ellipse",{cx:`${n.x+n.width/2}${n.unit}`,cy:`${n.y+n.height/2}${n.unit}`,rx:`${n.width/2}${n.unit}`,ry:`${n.height/2}${n.unit}`,fill:"black"}):p.createElement("rect",{x:`${n.x}${n.unit}`,y:`${n.y}${n.unit}`,width:`${n.width}${n.unit}`,height:`${n.height}${n.unit}`,fill:"black"}))),p.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,w)}};u(v,"xOrds",["e","w"]),u(v,"yOrds",["n","s"]),u(v,"xyOrds",["nw","ne","se","sw"]),u(v,"nudgeStep",1),u(v,"nudgeStepMedium",10),u(v,"nudgeStepLarge",100),u(v,"defaultProps",{ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}});let U=v;function T({showCropOverlay:d=!1,cropShape:t="rectangular",cropPosition:e={x:0,y:0},cropSize:o={width:100,height:100},onCropChange:i,...n}){const a=b.useRef(null),[c,h]=b.useState(0),[r,l]=b.useState(0),[g,w]=b.useState({unit:"px",x:0,y:0,width:0,height:0}),s=a.current?c/a.current.width:1,x=m=>{const{naturalWidth:Y,naturalHeight:X}=m.currentTarget;if(h(Y),l(X),!g.width&&!g.height&&i){const H={unit:"px",x:Math.floor(Y/4),y:Math.floor(X/4),width:Math.floor(Y/2),height:Math.floor(X/2)};w(H),i({x:H.x,y:H.y},{width:H.width,height:H.height})}};b.useEffect(()=>{c&&r&&(e.x!==0||e.y!==0||o.width!==100||o.height!==100)&&w({unit:"px",x:e.x/s,y:e.y/s,width:o.width/s,height:o.height/s})},[e,o,c,r,s]);const y=m=>{w(m)},f=m=>{i&&i({x:Math.round(m.x*s),y:Math.round(m.y*s)},{width:Math.round(m.width*s),height:Math.round(m.height*s)})};return k.jsx(P,{...n,type:"image",children:({preview:m})=>k.jsx(S,{width:"100%",height:"100%",sx:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden"},children:d?k.jsx(U,{crop:g,onChange:y,onComplete:f,circularCrop:t==="circular",style:{maxWidth:"100%",maxHeight:_},children:k.jsx("img",{ref:a,src:m,alt:"Preview",style:{maxWidth:"100%",maxHeight:_},onLoad:x})}):k.jsx("img",{ref:a,src:m,alt:"Preview",style:{maxWidth:"100%",maxHeight:_},onLoad:x})})})}export{T};
