import{r as a,aA as Q,j as M,B as Y}from"./index-C_g83nc7.js";import{T as K}from"./ToolContent-CPG3NUPt.js";import"./TextField-BB1W8KIt.js";var E=function(){return E=Object.assign||function(o){for(var f,s=1,u=arguments.length;s<u;s++)for(var e in f=arguments[s])Object.prototype.hasOwnProperty.call(f,e)&&(o[e]=f[e]);return o},E.apply(this,arguments)};function y(o,f,s,u){return new(s||(s=Promise))(function(e,i){function m(p){try{h(u.next(p))}catch(r){i(r)}}function b(p){try{h(u.throw(p))}catch(r){i(r)}}function h(p){var r;p.done?e(p.value):(r=p.value,r instanceof s?r:new s(function(_){_(r)})).then(m,b)}h((u=u.apply(o,f||[])).next())})}function x(o,f){var s,u,e,i={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]},m=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return m.next=b(0),m.throw=b(1),m.return=b(2),typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function b(h){return function(p){return function(r){if(s)throw new TypeError("Generator is already executing.");for(;m&&(m=0,r[0]&&(i=0)),i;)try{if(s=1,u&&(e=2&r[0]?u.return:r[0]?u.throw||((e=u.return)&&e.call(u),0):u.next)&&!(e=e.call(u,r[1])).done)return e;switch(u=0,e&&(r=[2&r[0],e.value]),r[0]){case 0:case 1:e=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,u=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(e=i.trys,!((e=e.length>0&&e[e.length-1])||r[0]!==6&&r[0]!==2)){i=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){i.label=r[1];break}if(r[0]===6&&i.label<e[1]){i.label=e[1],e=r;break}if(e&&i.label<e[2]){i.label=e[2],i.ops.push(r);break}e[2]&&i.ops.pop(),i.trys.pop();continue}r=f.call(o,i)}catch(_){r=[6,_],u=0}finally{s=e=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([h,p])}}}var O=function(o,f){var s="".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,15));return new Promise(function(u){var e,i=function(b){var h=function(){try{var _=JSON.parse(b.data);return _.type!=="REQUEST_RESULT"?null:_}catch{return null}}();if(h!==null){var p=b.source===o.contentWindow,r=h.data.request_id===s;p&&r&&(u(h.data.result),window.removeEventListener("message",i),clearTimeout(m))}};window.addEventListener("message",i),(e=o.contentWindow)===null||e===void 0||e.postMessage(JSON.stringify(E(E({},f),{request_id:s})),"*");var m=setTimeout(function(){u({success:!1,error:{code:"unexpected:request_timed_out",message:"The request timed out: try again"}}),window.removeEventListener("message",i)},3e4)})};(function(o){if(typeof window>"u")return;const f=document.createElement("style");f.setAttribute("type","text/css"),f.innerHTML=o,document.head.appendChild(f)})(".simplePDF_container{-webkit-user-select:none;-moz-user-select:none;user-select:none;position:fixed;display:flex;box-sizing:border-box;align-items:center;justify-content:center;height:100vh;width:100%;z-index:999999;padding:16px;top:0;left:0;background:rgba(0,0,0,.5)}.simplePDF_content{width:100%;height:100%;position:relative;box-sizing:border-box}.simplePDF_iframeContainer{overflow:hidden;background:#f1f7ff;border-radius:6px;width:100%;height:100%}.simplePDF_iframe{border:none;border-radius:6px;width:100%;height:100%}.simplePDF_close{z-index:1;position:absolute;top:-12px;right:-12px;border:none;padding:6px;border-radius:50px;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.24);cursor:pointer;background:#ff5959;text-shadow:1px 1px #243889}.simplePDF_close svg{fill:#fff;width:14px;height:14px}.simplePDF_close:hover{box-shadow:0 2px 4px rgba(0,0,0,.1),0 4px 4px rgba(0,0,0,.24)}");var X=function(){return a.createElement("svg",{height:"512",viewBox:"0 0 512 512",width:"512",xmlSpace:"preserve",xmlns:"http://www.w3.org/2000/svg"},a.createElement("path",{d:"M443.6 387.1 312.4 255.4l131.5-130c5.4-5.4 5.4-14.2 0-19.6l-37.4-37.6c-2.6-2.6-6.1-4-9.8-4-3.7 0-7.2 1.5-9.8 4L256 197.8 124.9 68.3c-2.6-2.6-6.1-4-9.8-4-3.7 0-7.2 1.5-9.8 4L68 105.9c-5.4 5.4-5.4 14.2 0 19.6l131.5 130L68.4 387.1c-2.6 2.6-4.1 6.1-4.1 9.8 0 3.7 1.4 7.2 4.1 9.8l37.4 37.6c2.7 2.7 6.2 4.1 9.8 4.1 3.5 0 7.1-1.3 9.8-4.1L256 313.1l130.7 131.1c2.7 2.7 6.2 4.1 9.8 4.1 3.5 0 7.1-1.3 9.8-4.1l37.4-37.6c2.6-2.6 4.1-6.1 4.1-9.8-.1-3.6-1.6-7.1-4.2-9.7z"}))},J=function(o){return o.mode==="inline"},Z=a.forwardRef(function(o,f){var s=o.className,u=o.style;return a.createElement("iframe",{ref:f,title:"SimplePDF",className:s,style:E({border:0},u)})}),$=a.forwardRef(function(o,f){var s=o.children,u=o.editorURL,e=a.useState(!1),i=e[0],m=e[1],b=a.useCallback(function(p){p.preventDefault(),m(!0)},[]),h=a.useCallback(function(){m(!1)},[]);return a.createElement(a.Fragment,null,i&&Q.createPortal(a.createElement("div",{className:"simplePDF_container",role:"dialog","aria-modal":"true"},a.createElement("div",{className:"simplePDF_content"},a.createElement("button",{onClick:h,className:"simplePDF_close","aria-label":"Close PDF editor modal"},a.createElement(X,null)),a.createElement("div",{className:"simplePDF_iframeContainer"},a.createElement("iframe",{ref:f,title:"SimplePDF",referrerPolicy:"no-referrer-when-downgrade",className:"simplePDF_iframe",src:u})))),document.body),a.isValidElement(s)?a.cloneElement(s,{onClick:b}):null)}),ee=a.forwardRef(function(o,f){var s,u,e,i,m=o.context,b=o.companyIdentifier,h=o.locale,p=o.baseDomain,r=a.useRef(null),_=a.useRef(null),L=a.useState({type:null,value:null,isEditorReady:!1}),w=L[0],T=L[1],d=a.useRef(null),S=a.useMemo(function(){return function(t){var n=t.baseDomain,c=t.companyIdentifier,l=n??"simplepdf.com",v=c??"react-editor",g=l.includes(".nil")||l.includes("localhost");return"".concat(g?"http":"https","://").concat(v,".").concat(l)}({baseDomain:p,companyIdentifier:b})},[p,b]),F=function(){return y(void 0,void 0,void 0,function(){return x(this,function(t){switch(t.label){case 0:return r.current?[4,r.current]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},z=a.useCallback(function(t){return y(void 0,[t],void 0,function(n){var c=n.dataUrl,l=n.name,v=n.page;return x(this,function(g){switch(g.label){case 0:return d.current?[4,F()]:[2,{success:!1,error:{code:"unexpected:iframe_not_available",message:"Iframe not available"}}];case 1:return g.sent(),[2,O(d.current,{type:"LOAD_DOCUMENT",data:{data_url:c,name:l,page:v}})]}})})},[]),B=a.useCallback(function(t){return y(void 0,[t],void 0,function(n){var c=n.page;return x(this,function(l){switch(l.label){case 0:return d.current?[4,F()]:[2,{success:!1,error:{code:"unexpected:iframe_not_available",message:"Iframe not available"}}];case 1:return l.sent(),[2,O(d.current,{type:"GO_TO",data:{page:c}})]}})})},[]),G=a.useCallback(function(t){return y(void 0,void 0,void 0,function(){return x(this,function(n){switch(n.label){case 0:return d.current?[4,F()]:[2,{success:!1,error:{code:"unexpected:iframe_not_available",message:"Iframe not available"}}];case 1:return n.sent(),[2,O(d.current,{type:"SELECT_TOOL",data:{tool:t}})]}})})},[]),q=a.useCallback(function(t){return y(void 0,void 0,void 0,function(){return x(this,function(n){switch(n.label){case 0:return d.current?[4,F()]:[2,{success:!1,error:{code:"unexpected:iframe_not_available",message:"Iframe not available"}}];case 1:return n.sent(),[2,O(d.current,{type:"CREATE_FIELD",data:t})]}})})},[]),W=a.useCallback(function(t){return y(void 0,void 0,void 0,function(){return x(this,function(n){switch(n.label){case 0:return d.current?[4,F()]:[2,{success:!1,error:{code:"unexpected:iframe_not_available",message:"Iframe not available"}}];case 1:return n.sent(),[2,O(d.current,{type:"CLEAR_FIELDS",data:{field_ids:t==null?void 0:t.fieldIds,page:t==null?void 0:t.page}})]}})})},[]),H=a.useCallback(function(t){return y(void 0,void 0,void 0,function(){return x(this,function(n){switch(n.label){case 0:return d.current?[4,F()]:[2,{success:!1,error:{code:"unexpected:iframe_not_available",message:"Iframe not available"}}];case 1:return n.sent(),[2,O(d.current,{type:"GET_DOCUMENT_CONTENT",data:{extraction_mode:t.extractionMode}})]}})})},[]),V=a.useCallback(function(t){return y(void 0,[t],void 0,function(n){var c=n.downloadCopyOnDevice;return x(this,function(l){switch(l.label){case 0:return d.current?[4,F()]:[2,{success:!1,error:{code:"unexpected:iframe_not_available",message:"Iframe not available"}}];case 1:return l.sent(),[2,O(d.current,{type:"SUBMIT",data:{download_copy:c}})]}})})},[]);a.useImperativeHandle(f,function(){return{loadDocument:z,goTo:B,selectTool:G,createField:q,clearFields:W,getDocumentContent:H,submit:V}}),a.useEffect(function(){r.current=new Promise(function(t){_.current=t})},[]);var P=J(o)?(s=o.documentURL)!==null&&s!==void 0?s:null:(i=(e=(u=o.children)===null||u===void 0?void 0:u.props)===null||e===void 0?void 0:e.href)!==null&&i!==void 0?i:null;a.useEffect(function(){if(P){var t=function(n){var c=n.substring(n.lastIndexOf("/")+1).split("?")[0];return c??""}(P);y(void 0,void 0,void 0,function(){var n,c,l;return x(this,function(v){switch(v.label){case 0:return[4,fetch(P,{method:"GET",credentials:"same-origin"})];case 1:if(!(n=v.sent()).ok)throw new Error("Failed to retrieve the document: ".concat(JSON.stringify({status:n.status,url:P})));return[4,n.blob()];case 2:return c=v.sent(),l=new FileReader,[4,new Promise(function(g,D){l.onload=g,l.onerror=D,l.readAsDataURL(c)})];case 3:return v.sent(),[2,l.result]}})}).then(function(n){return T(function(c){return E(E({},c),{type:"iframe_event",value:n,documentName:t})})}).catch(function(){T(function(n){return E(E({},n),{type:"cors_proxy_fallback",value:P})})})}},[P]),a.useEffect(function(){var t,n;if(w.isEditorReady&&w.type==="iframe_event"&&w.value!==null){var c=new URL(S);(n=(t=d.current)===null||t===void 0?void 0:t.contentWindow)===null||n===void 0||n.postMessage(JSON.stringify({type:"LOAD_DOCUMENT",data:{data_url:w.value,name:w.documentName}}),c.origin)}},[w,S]);var R=a.useCallback(function(t){return y(void 0,void 0,void 0,function(){var n,c,l,v,g;return x(this,function(D){switch(D.label){case 0:if(n=new URL(t.origin).origin,c=new URL(S).origin,n!==c)return[2];if(t.source!==((g=d.current)===null||g===void 0?void 0:g.contentWindow))return[2];if((l=function(){try{return JSON.parse(t.data)}catch{return console.error("Failed to parse iFrame event payload"),null}}())===null)return[2];switch(v=function(C){return y(void 0,void 0,void 0,function(){var A,U;return x(this,function(N){switch(N.label){case 0:return N.trys.push([0,2,,3]),[4,(U=o.onEmbedEvent)===null||U===void 0?void 0:U.call(o,C)];case 1:return N.sent(),[3,3];case 2:return A=N.sent(),console.error("onEmbedEvent failed to execute: ".concat(JSON.stringify(A))),[3,3];case 3:return[2]}})})},l.type){case"EDITOR_READY":return[3,1];case"DOCUMENT_LOADED":return[3,3];case"PAGE_FOCUSED":return[3,5];case"SUBMISSION_SENT":return[3,7]}return[3,9];case 1:return T(function(C){return E(E({},C),{isEditorReady:!0})}),[4,v(l)];case 2:case 4:case 6:case 8:return D.sent(),[2];case 3:return setTimeout(function(){var C;return(C=_.current)===null||C===void 0?void 0:C.call(_)},200),[4,v(l)];case 5:case 7:return[4,v(l)];case 9:return[2]}})})},[o.onEmbedEvent,S]);a.useEffect(function(){return window.addEventListener("message",R,!1),function(){return window.removeEventListener("message",R)}},[R]);var j=a.useMemo(function(){return function(t){if(!t)return null;try{return encodeURIComponent(btoa(JSON.stringify(t)))}catch(n){return console.error("Failed to encode the context: ".concat(JSON.stringify(n)),{context:t}),null}}(m)},[JSON.stringify(m)]),k=a.useMemo(function(){return function(t){var n=t.editorDomain,c=t.locale,l=t.encodedContext,v=t.hasDocumentUrl,g=t.corsProxyFallbackUrl,D=new URL("/".concat(c??"en","/editor"),n);return l&&D.searchParams.set("context",l),v&&D.searchParams.set("loadingPlaceholder","true"),g!==null&&D.searchParams.set("open",g),D.href}({editorDomain:S,locale:h,encodedContext:j,hasDocumentUrl:!!P,corsProxyFallbackUrl:(w==null?void 0:w.type)==="cors_proxy_fallback"&&(w==null?void 0:w.value)!==null?w.value:null})},[S,P,j,w,h]),I=J(o);return a.useEffect(function(){I&&d&&d.current&&(d.current.src=k)},[k,I]),I?a.createElement(Z,{className:o.className,style:o.style,ref:d}):a.createElement($,{children:o.children,editorURL:k,ref:d})});function ae({title:o}){return M.jsx(K,{title:o,initialValues:{},getGroups:null,input:null,inputComponent:M.jsx(Y,{sx:{width:"100%",height:"80vh"},children:M.jsx(ee,{mode:"inline",style:{width:"100%",height:"100%"}})}),toolInfo:{title:"PDF Editor",description:"Edit, annotate, highlight, fill forms, and export your PDFs entirely in the browser. Add text, drawings, signatures, and more to your PDF documents with this powerful online editor."},compute:()=>{}})}export{ae as default};
